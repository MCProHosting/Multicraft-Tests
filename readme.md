#multicraft-tests

Testing framework for Multicraft - make sure your development of themes or functionality doesn't break stuff. Test locally or on a service like Travis. Licensed under the GPL. Essentially:

 * You must disclose the source of any modifications to this testing framework.
 * You must state any changes that were made to the source.
 * You must keep notices of copyright ("Copyright 2014 MCProHosting"), and the license, in any derivatives.
 * You may not hold MCProHosting or its affiliates liable for anything relating to this testing framework or its use.
 * You may not redistribute modifications of this software.

## Usage

### Prerequisites

#### PHP

*Ensure you're using PHP >= 5.4*. Older versions (that are often the default in package managers like yum and apt) do not have the CLI web server that this runs tests on. You will need to update your sources, or install it directly:

 * Instructions for CentOS and other RHEL-based distros [here](http://www.rackspace.com/knowledge_center/article/installing-rhel-epel-repo-on-centos-5x-or-6x).
 * PPA for Debian-based systems [here](https://launchpad.net/~ondrej/+archive/php5).
 * Most recent source [here](http://php.net/downloads.php).

You must also ensure you have the SQLite adapter enabled.

#### Node.js

Ensure that you're running a reasonably modern version of Node.js, with the NPM package manager. Installation *will* fail if you use a deprecated version of Node, which usually occurs in most package managers by default. You will need to update your sources, or install it directly:

 * Instructions for EPEL on CentOS [here](http://www.rackspace.com/knowledge_center/article/installing-rhel-epel-repo-on-centos-5x-or-6x).
 * PPA for Debian-based systems [here](https://launchpad.net/~chris-lea/+archive/node.js).
 * Most recent binaries and sources [here](http://nodejs.org/download/).

#### Local Readying...

 1. Run `npm install` while cd'd into this repo's directory.
 2. Clone your panel into the "panel" directory by running `git clone <panel .git> panel`

Additionally, there is an option to run custom scripts. If a `setup/setup.sh`, `setup/setup.bat`, and/or `setup/setup.js` is present, they will be executed. Note that these are run in parallel to the config and database mirroring - don't assume that they will be present before your script being executed.

 * Shell scripts will run on Unix/Linux based systems only, and they are run with the current working directory set to the panel's directory.
 * Batch scripts will run on Windows only, and are run with the current working directory set to the panel's directory.
 * Javascript files will run on all systems, and are therefore recommended. It is expected that they will export a single function, which multicraft-tests then calls with the first argument being the panel directory, and the second argument being a callback to execute when complete.


### Running Tests

Run, from the command line:

```bash
node test.js
```

This will run a full suite of tests against the panel. It'll take about a minute, especially after it hits the individual servers page. Hopefully you'll see something like this:

```bash
Connors-MacBook-Air:mcph-multicraft-tests connor$ node test.js

................................................................................................................................................................
0/160 Assertions Failed
You're good to deploy!
```
If you don't, that means something is wrong! Most tests involve ensuring that a 200 response was returned, that the page `<body>` is present, and that there are no console errors (usually generated by Javascript). This is by no means a comprehensive test of everything on the panel, but it should be good to catch any critical errors before they hit deployment!

In order to update the panel after you make changes and push it into version control, simply:

```bash
cd panel && git pull
```

> Note: do **not** run your panel in production out of this test environment! Each time tests are run, an artificial environment is set up which will wipe any data and application from the panel.
